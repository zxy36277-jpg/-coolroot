<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>改进后的解析测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 3px;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
        }
        .sample-text {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .expected, .actual {
            padding: 15px;
            border-radius: 5px;
        }
        .expected {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
        }
        .actual {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        .field-comparison {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .field-match {
            background: #d4edda;
        }
        .field-mismatch {
            background: #f8d7da;
        }
        .field-missing {
            background: #fff3cd;
        }
        .improvement-note {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>改进后的文件解析测试</h1>
    
    <div class="improvement-note">
        <h3>🔧 改进内容</h3>
        <ul>
            <li>✅ 支持多种正则表达式模式匹配</li>
            <li>✅ 改进品牌名称清理逻辑</li>
            <li>✅ 优化卖点解析，支持多种分隔符</li>
            <li>✅ 增强平台匹配准确性</li>
            <li>✅ 添加详细的调试日志</li>
            <li>✅ 改进字段验证和默认值填充</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h3>测试1: 标准格式解析</h3>
        <div class="sample-text">华为Mate 60 Pro品牌手册

品牌名称：华为Mate 60 Pro
核心卖点：麒麟9000S芯片、卫星通话、超感知影像
活动优惠：首发立减800元，送无线充电器
行业：3c数码
目标人群：商务人士和科技爱好者，25-45岁用户
视频目的：广告营销卖货
平台：抖音、快手、B站
违禁词：最好、第一、绝对、完美、顶级</div>
        <button onclick="testImprovedParsing(1)">测试标准格式解析</button>
        <div id="result1" class="result"></div>
    </div>

    <div class="test-section">
        <h3>测试2: 简化格式解析</h3>
        <div class="sample-text">品牌: 小米13 Ultra
卖点: 徕卡影像、骁龙8 Gen2、陶瓷机身
优惠: 限时优惠，欢迎咨询
行业: 3c数码
人群: 摄影爱好者和性能用户
目的: 广告营销卖货
平台: 抖音, 小红书, B站
违禁词: 最好, 第一, 绝对</div>
        <button onclick="testImprovedParsing(2)">测试简化格式解析</button>
        <div id="result2" class="result"></div>
    </div>

    <div class="test-section">
        <h3>测试3: 不完整信息处理</h3>
        <div class="sample-text">品牌名称：OPPO Find X6 Pro
核心卖点：哈苏影像、天玑9200、120Hz屏幕
行业：3c数码</div>
        <button onclick="testImprovedParsing(3)">测试不完整信息处理</button>
        <div id="result3" class="result"></div>
    </div>

    <div class="test-section">
        <h3>测试4: 复杂卖点解析</h3>
        <div class="sample-text">品牌名称：测试产品
核心卖点：功能A、功能B、功能C、功能D、功能E
行业：3c数码</div>
        <button onclick="testImprovedParsing(4)">测试复杂卖点解析</button>
        <div id="result4" class="result"></div>
    </div>

    <div class="test-section">
        <h3>测试5: 平台解析准确性</h3>
        <div class="sample-text">品牌名称：测试产品
平台：抖音、快手、小红书、B站、淘宝、京东
行业：3c数码</div>
        <button onclick="testImprovedParsing(5)">测试平台解析准确性</button>
        <div id="result5" class="result"></div>
    </div>

    <script>
        const API_BASE = 'https://coolroot.vercel.app/api';

        const testCases = [
            {
                name: '标准格式解析',
                content: `华为Mate 60 Pro品牌手册

品牌名称：华为Mate 60 Pro
核心卖点：麒麟9000S芯片、卫星通话、超感知影像
活动优惠：首发立减800元，送无线充电器
行业：3c数码
目标人群：商务人士和科技爱好者，25-45岁用户
视频目的：广告营销卖货
平台：抖音、快手、B站
违禁词：最好、第一、绝对、完美、顶级`,
                expected: {
                    brandName: '华为Mate 60 Pro',
                    sellingPoints: ['麒麟9000S芯片', '卫星通话', '超感知影像'],
                    promotionInfo: '首发立减800元，送无线充电器',
                    industry: '3c数码',
                    targetAudience: '商务人士和科技爱好者，25-45岁用户',
                    videoPurpose: '广告营销卖货',
                    platforms: ['抖音', '快手', 'B站'],
                    forbiddenWords: '最好、第一、绝对、完美、顶级'
                }
            },
            {
                name: '简化格式解析',
                content: `品牌: 小米13 Ultra
卖点: 徕卡影像、骁龙8 Gen2、陶瓷机身
优惠: 限时优惠，欢迎咨询
行业: 3c数码
人群: 摄影爱好者和性能用户
目的: 广告营销卖货
平台: 抖音, 小红书, B站
违禁词: 最好, 第一, 绝对`,
                expected: {
                    brandName: '小米13 Ultra',
                    sellingPoints: ['徕卡影像', '骁龙8 Gen2', '陶瓷机身'],
                    promotionInfo: '限时优惠，欢迎咨询',
                    industry: '3c数码',
                    targetAudience: '摄影爱好者和性能用户',
                    videoPurpose: '广告营销卖货',
                    platforms: ['抖音', '小红书', 'B站'],
                    forbiddenWords: '最好, 第一, 绝对'
                }
            },
            {
                name: '不完整信息处理',
                content: `品牌名称：OPPO Find X6 Pro
核心卖点：哈苏影像、天玑9200、120Hz屏幕
行业：3c数码`,
                expected: {
                    brandName: 'OPPO Find X6 Pro',
                    sellingPoints: ['哈苏影像', '天玑9200', '120Hz屏幕'],
                    industry: '3c数码',
                    // 应该有默认值
                    videoPurpose: '广告营销卖货',
                    platforms: ['抖音', '小红书'],
                    targetAudience: '25-35岁用户',
                    promotionInfo: '限时优惠，欢迎咨询',
                    forbiddenWords: '最好，第一，绝对'
                }
            },
            {
                name: '复杂卖点解析',
                content: `品牌名称：测试产品
核心卖点：功能A、功能B、功能C、功能D、功能E
行业：3c数码`,
                expected: {
                    brandName: '测试产品',
                    sellingPoints: ['功能A', '功能B', '功能C'], // 应该只取前3个
                    industry: '3c数码'
                }
            },
            {
                name: '平台解析准确性',
                content: `品牌名称：测试产品
平台：抖音、快手、小红书、B站、淘宝、京东
行业：3c数码`,
                expected: {
                    brandName: '测试产品',
                    platforms: ['抖音', '快手', '小红书', 'B站', '淘宝', '京东'],
                    industry: '3c数码'
                }
            }
        ];

        async function testImprovedParsing(testNumber) {
            const resultDiv = document.getElementById(`result${testNumber}`);
            const testCase = testCases[testNumber - 1];
            
            resultDiv.textContent = '正在测试改进后的解析逻辑...';
            resultDiv.className = 'result';

            try {
                const response = await fetch(`${API_BASE}/upload`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: testCase.content
                });

                const data = await response.json();

                if (data.success) {
                    const actual = data.data.extractedInfo;
                    const expected = testCase.expected;
                    
                    // 比较结果
                    const comparison = compareResults(expected, actual);
                    
                    resultDiv.innerHTML = `
                        <div class="comparison">
                            <div class="expected">
                                <h4>期望结果</h4>
                                <pre>${JSON.stringify(expected, null, 2)}</pre>
                            </div>
                            <div class="actual">
                                <h4>实际结果</h4>
                                <pre>${JSON.stringify(actual, null, 2)}</pre>
                            </div>
                        </div>
                        <h4>字段对比分析</h4>
                        ${comparison.html}
                        <h4>总体评估</h4>
                        <p><strong>准确率:</strong> ${comparison.accuracy}% (${comparison.matchCount}/${comparison.totalCount})</p>
                        <p><strong>状态:</strong> ${comparison.status}</p>
                        <p><strong>改进效果:</strong> ${comparison.improvement}</p>
                    `;
                    
                    if (comparison.accuracy >= 90) {
                        resultDiv.className = 'result success';
                    } else if (comparison.accuracy >= 70) {
                        resultDiv.className = 'result warning';
                    } else {
                        resultDiv.className = 'result error';
                    }
                } else {
                    resultDiv.textContent = `❌ 解析失败: ${data.error}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.textContent = `❌ 请求失败: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        function compareResults(expected, actual) {
            const allFields = new Set([...Object.keys(expected), ...Object.keys(actual)]);
            let matchCount = 0;
            let totalCount = allFields.size;
            let html = '';

            for (const field of allFields) {
                const expectedValue = expected[field];
                const actualValue = actual[field];
                
                let status = '';
                let className = '';
                
                if (expectedValue === undefined) {
                    status = '多余字段';
                    className = 'field-missing';
                } else if (actualValue === undefined) {
                    status = '缺失字段';
                    className = 'field-missing';
                } else if (JSON.stringify(expectedValue) === JSON.stringify(actualValue)) {
                    status = '完全匹配';
                    className = 'field-match';
                    matchCount++;
                } else {
                    status = '不匹配';
                    className = 'field-mismatch';
                }
                
                html += `
                    <div class="field-comparison ${className}">
                        <strong>${field}:</strong> ${status}<br>
                        <small>期望: ${JSON.stringify(expectedValue)}</small><br>
                        <small>实际: ${JSON.stringify(actualValue)}</small>
                    </div>
                `;
            }

            const accuracy = Math.round((matchCount / totalCount) * 100);
            let status = '';
            let improvement = '';
            
            if (accuracy >= 90) {
                status = '✅ 解析非常准确';
                improvement = '🎉 改进效果显著，解析准确性大幅提升';
            } else if (accuracy >= 70) {
                status = '⚠️ 解析基本准确，有改进空间';
                improvement = '📈 改进有一定效果，但仍有优化空间';
            } else {
                status = '❌ 解析不准确，需要进一步优化';
                improvement = '🔧 需要进一步改进解析逻辑';
            }

            return {
                accuracy,
                matchCount,
                totalCount,
                status,
                improvement,
                html
            };
        }
    </script>
</body>
</html>
