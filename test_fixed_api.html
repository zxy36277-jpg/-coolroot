<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .test-section h3 {
            margin-top: 0;
            color: #007bff;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .result.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result.loading {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ APIä¿®å¤éªŒè¯æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>1. å¥åº·æ£€æŸ¥æµ‹è¯•</h3>
            <button onclick="testHealth()">æµ‹è¯• /api/health</button>
            <div id="healthResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>2. åˆ›å»ºä¼šè¯æµ‹è¯•</h3>
            <button onclick="testCreateSession()">æµ‹è¯• /api/scripts/sessions</button>
            <div id="sessionResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>3. æ–‡ä»¶ä¸Šä¼ æµ‹è¯•</h3>
            <button onclick="testFileUpload()">æµ‹è¯• /api/scripts/upload</button>
            <div id="uploadResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>4. è„šæœ¬ç”Ÿæˆæµ‹è¯•</h3>
            <button onclick="testGenerateScripts()">æµ‹è¯• /api/scripts/generate</button>
            <div id="generateResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>5. å®Œæ•´æµç¨‹æµ‹è¯•</h3>
            <button onclick="testFullWorkflow()">æµ‹è¯•å®Œæ•´å·¥ä½œæµç¨‹</button>
            <div id="workflowResult" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5119/api';
        
        async function testHealth() {
            const result = document.getElementById('healthResult');
            result.className = 'result loading';
            result.textContent = 'æ­£åœ¨æµ‹è¯•å¥åº·æ£€æŸ¥...';
            
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                if (response.ok) {
                    result.className = 'result success';
                    result.textContent = `âœ… å¥åº·æ£€æŸ¥æˆåŠŸ\n${JSON.stringify(data, null, 2)}`;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                result.className = 'result error';
                result.textContent = `âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`;
            }
        }
        
        async function testCreateSession() {
            const result = document.getElementById('sessionResult');
            result.className = 'result loading';
            result.textContent = 'æ­£åœ¨åˆ›å»ºä¼šè¯...';
            
            try {
                const response = await fetch(`${API_BASE}/scripts/sessions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                if (response.ok && data.success) {
                    result.className = 'result success';
                    result.textContent = `âœ… ä¼šè¯åˆ›å»ºæˆåŠŸ\nä¼šè¯ID: ${data.data.sessionId}\n${JSON.stringify(data, null, 2)}`;
                } else {
                    throw new Error(data.error || `HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                result.className = 'result error';
                result.textContent = `âŒ ä¼šè¯åˆ›å»ºå¤±è´¥: ${error.message}`;
            }
        }
        
        async function testFileUpload() {
            const result = document.getElementById('uploadResult');
            result.className = 'result loading';
            result.textContent = 'æ­£åœ¨æµ‹è¯•æ–‡ä»¶ä¸Šä¼ ...';
            
            try {
                const testContent = `æ–èƒFineNutriå“ç‰Œæ‰‹å†Œ

å“ç‰Œä»‹ç»ï¼š
æ–èƒFineNutriæ˜¯ä¸€å®¶ä¸“æ³¨äºé«˜ç«¯è¥å…»ä¿å¥å“çš„å“ç‰Œï¼Œè‡´åŠ›äºä¸ºæ¶ˆè´¹è€…æä¾›ç§‘å­¦ã€å®‰å…¨ã€æœ‰æ•ˆçš„è¥å…»è¡¥å……è§£å†³æ–¹æ¡ˆã€‚

äº§å“ä¿¡æ¯ï¼š
- å“ç‰Œåç§°ï¼šæ–èƒFineNutri
- äº§å“ç±»å‹ï¼šä¿å¥å“
- æ ¸å¿ƒå–ç‚¹ï¼š
  1. ç§‘å­¦é…æ–¹ï¼šé‡‡ç”¨å›½é™…å…ˆè¿›é…æ–¹ï¼Œç»è¿‡ä¸¥æ ¼ç§‘å­¦éªŒè¯
  2. å¤©ç„¶åŸæ–™ï¼šç²¾é€‰å…¨çƒä¼˜è´¨å¤©ç„¶åŸæ–™ï¼Œæ— æ·»åŠ é˜²è…å‰‚
  3. ä¸“ä¸šè®¤è¯ï¼šè·å¾—å¤šé¡¹å›½é™…æƒå¨è®¤è¯ï¼Œå“è´¨æœ‰ä¿éšœ

ç›®æ ‡äººç¾¤ï¼š
- å…³æ³¨å¥åº·çš„æˆå¹´äºº
- éœ€è¦è¥å…»è¡¥å……çš„ä¸­è€å¹´äºº
- è¿½æ±‚é«˜å“è´¨ç”Ÿæ´»çš„æ¶ˆè´¹è€…

è¥é”€ç›®çš„ï¼š
å“ç‰Œå®£ä¼ å’Œäº§å“æ¨å¹¿ï¼Œæå‡å“ç‰ŒçŸ¥ååº¦å’Œå¸‚åœºå æœ‰ç‡ã€‚

å¹³å°æ¨å¹¿ï¼š
æŠ–éŸ³ã€å¿«æ‰‹ã€å°çº¢ä¹¦ã€Bç«™ç­‰çŸ­è§†é¢‘å¹³å°ã€‚`;

                const response = await fetch(`${API_BASE}/scripts/upload`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: testContent
                });
                const data = await response.json();
                
                if (response.ok && data.success) {
                    result.className = 'result success';
                    result.textContent = `âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸ\n\næå–çš„å“ç‰Œä¿¡æ¯:\n${JSON.stringify(data.data.extractedInfo, null, 2)}\n\nå†…å®¹é¢„è§ˆ:\n${data.data.content.substring(0, 200)}...`;
                } else {
                    throw new Error(data.error || `HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                result.className = 'result error';
                result.textContent = `âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ${error.message}`;
            }
        }
        
        async function testGenerateScripts() {
            const result = document.getElementById('generateResult');
            result.className = 'result loading';
            result.textContent = 'æ­£åœ¨æµ‹è¯•è„šæœ¬ç”Ÿæˆ...';
            
            try {
                const requestData = {
                    sessionId: 'test-session-' + Date.now(),
                    productInfo: {
                        brandName: 'æ–èƒFineNutri',
                        industry: 'ä¿å¥å“',
                        sellingPoints: ['ç§‘å­¦é…æ–¹', 'å¤©ç„¶åŸæ–™', 'ä¸“ä¸šè®¤è¯'],
                        targetAudience: 'å…³æ³¨å¥åº·çš„æˆå¹´äºº',
                        videoPurpose: 'å“ç‰Œå®£ä¼ å’Œäº§å“æ¨å¹¿',
                        platforms: ['æŠ–éŸ³', 'å¿«æ‰‹', 'å°çº¢ä¹¦'],
                        forbiddenWords: 'æ²»ç–—, æ²»æ„ˆ, é¢„é˜²ç–¾ç—…'
                    }
                };
                
                const response = await fetch(`${API_BASE}/scripts/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                const data = await response.json();
                
                if (response.ok && data.success) {
                    result.className = 'result success';
                    result.textContent = `âœ… è„šæœ¬ç”ŸæˆæˆåŠŸ\nç”Ÿæˆäº† ${data.data.scripts.length} ä¸ªè„šæœ¬\n\nç¬¬ä¸€ä¸ªè„šæœ¬æ ‡é¢˜: ${data.data.scripts[0].title}\n\nå®Œæ•´å“åº”:\n${JSON.stringify(data, null, 2)}`;
                } else {
                    throw new Error(data.error || `HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                result.className = 'result error';
                result.textContent = `âŒ è„šæœ¬ç”Ÿæˆå¤±è´¥: ${error.message}`;
            }
        }
        
        async function testFullWorkflow() {
            const result = document.getElementById('workflowResult');
            result.className = 'result loading';
            result.textContent = 'æ­£åœ¨æµ‹è¯•å®Œæ•´å·¥ä½œæµç¨‹...\n';
            
            try {
                // æ­¥éª¤1: åˆ›å»ºä¼šè¯
                result.textContent += 'æ­¥éª¤1: åˆ›å»ºä¼šè¯...\n';
                const sessionResponse = await fetch(`${API_BASE}/scripts/sessions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const sessionData = await sessionResponse.json();
                
                if (!sessionResponse.ok || !sessionData.success) {
                    throw new Error('åˆ›å»ºä¼šè¯å¤±è´¥');
                }
                
                const sessionId = sessionData.data.sessionId;
                result.textContent += `âœ… ä¼šè¯åˆ›å»ºæˆåŠŸ: ${sessionId}\n`;
                
                // æ­¥éª¤2: ä¸Šä¼ æ–‡ä»¶
                result.textContent += 'æ­¥éª¤2: ä¸Šä¼ æ–‡ä»¶...\n';
                const uploadResponse = await fetch(`${API_BASE}/scripts/upload`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: 'æ–èƒFineNutriå“ç‰Œæ‰‹å†Œ\nå“ç‰Œåç§°ï¼šæ–èƒFineNutri\näº§å“ç±»å‹ï¼šä¿å¥å“\næ ¸å¿ƒå–ç‚¹ï¼šç§‘å­¦é…æ–¹ã€å¤©ç„¶åŸæ–™ã€ä¸“ä¸šè®¤è¯'
                });
                const uploadData = await uploadResponse.json();
                
                if (!uploadResponse.ok || !uploadData.success) {
                    throw new Error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥');
                }
                
                result.textContent += `âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œè¯†åˆ«å“ç‰Œ: ${uploadData.data.extractedInfo.brandName}\n`;
                
                // æ­¥éª¤3: ç”Ÿæˆè„šæœ¬
                result.textContent += 'æ­¥éª¤3: ç”Ÿæˆè„šæœ¬...\n';
                const generateResponse = await fetch(`${API_BASE}/scripts/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        sessionId: sessionId,
                        productInfo: uploadData.data.extractedInfo
                    })
                });
                const generateData = await generateResponse.json();
                
                if (!generateResponse.ok || !generateData.success) {
                    throw new Error('è„šæœ¬ç”Ÿæˆå¤±è´¥');
                }
                
                result.textContent += `âœ… è„šæœ¬ç”ŸæˆæˆåŠŸï¼Œç”Ÿæˆäº† ${generateData.data.scripts.length} ä¸ªè„šæœ¬\n`;
                result.textContent += `\nå®Œæ•´å·¥ä½œæµç¨‹æµ‹è¯•æˆåŠŸï¼\n`;
                result.textContent += `ç”Ÿæˆçš„è„šæœ¬ç±»å‹: ${generateData.data.scripts.map(s => s.templateType).join(', ')}\n`;
                
                result.className = 'result success';
                
            } catch (error) {
                result.className = 'result error';
                result.textContent += `âŒ å·¥ä½œæµç¨‹æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        }
    </script>
</body>
</html>
